<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Ulefone | Navigation</title>
<link rel="icon" href="https://wangwenzhi.eu.org/images/ulefone-logo/icon.png" sizes="32x32" type="image/png"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>

<style>
:root {
  /* 色块系统 */
  --bg-app: #f5f5f7;
  --bg-surface: #ffffff;
  --bg-block: #efeff1;
  --bg-active: #e5e5e7;
  
  --text-main: #000000;
  --text-sub: #86868b;
  --highlight: #ff3b30; /* 搜索高亮色 */
  
  --sidebar-width: 240px;
  --header-height: 72px;
  
  --radius-card: 16px;
  --pill: 99px;
  --scroll-offset: 100px;
}

/* 暗黑模式 */
body.dark-mode {
  --bg-app: #000000;
  --bg-surface: #1c1c1e;
  --bg-block: #2c2c2e;
  --bg-active: #3a3a3c;
  --text-main: #ffffff;
  --text-sub: #98989d;
  --highlight: #ff453a;
}

body {
  margin: 0;
  background: var(--bg-app);
  color: var(--text-main);
  font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", Roboto, sans-serif;
  font-size: 16px;
  line-height: 1.5;
  transition: background .2s, color .2s;
  height: 100vh;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

a { text-decoration: none; color: inherit; }
* { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }

/* === Animations (新增动画) === */
@keyframes fadeInUp {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}

/* 搜索高亮样式 */
mark {
  background: transparent;
  color: var(--highlight);
  font-weight: 800;
  padding: 0;
}

/* === Header === */
.header {
  height: var(--header-height);
  background: var(--bg-surface);
  display: flex; align-items: center; justify-content: space-between;
  padding: 0 40px;
  position: fixed; top: 0; left: 0; right: 0; z-index: 100;
}

.logo { height: 36px; display: flex; align-items: center; cursor: pointer; opacity: 0.95; }
.logo:hover { opacity: 1; }
.logo img { height: 100%; width: auto; display: block; }

.header-controls { display: flex; align-items: center; gap: 16px; }

.search-input {
  border: none;
  background: var(--bg-app);
  padding: 12px 24px;
  border-radius: var(--pill);
  font-size: 15px;
  color: var(--text-main);
  width: 260px;
  transition: all 0.2s;
}
.search-input:focus { background: var(--bg-block); width: 300px; }

.icon-btn {
  background: transparent; border: none; padding: 0;
  color: var(--text-main); font-size: 20px;
  width: 44px; height: 44px; border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  cursor: pointer; transition: background 0.2s;
}
.icon-btn:hover { background: var(--bg-block); }

/* === Layout === */
.container {
  display: flex;
  margin-top: var(--header-height);
  height: calc(100vh - var(--header-height));
  width: 100%;
}

/* === Sidebar === */
.sidebar {
  width: var(--sidebar-width);
  background: var(--bg-surface);
  padding: 24px 16px;
  overflow-y: auto;
  flex-shrink: 0;
  display: flex; flex-direction: column; 
}
.sidebar::-webkit-scrollbar { display: none; }

#category-list { list-style: none; padding: 0; margin: 0; display: flex; flex-direction: column; gap: 2px; }

#category-list li {
  padding: 10px 16px;
  border-radius: var(--pill);
  font-size: 15px; font-weight: 600;
  color: var(--text-sub);
  cursor: pointer;
  display: flex; align-items: center;
  transition: all 0.15s;
}
#category-list li i { width: 24px; font-size: 16px; margin-right: 12px; text-align: center; color: var(--text-sub); }

#category-list li:hover { background: var(--bg-block); color: var(--text-main); }
#category-list li:hover i { color: var(--text-main); }

#category-list li.active {
  background: var(--bg-active);
  color: var(--text-main);
  font-weight: 700;
}
#category-list li.active i { color: var(--text-main); }

/* === Main Content === */
.main {
  flex: 1;
  background: var(--bg-app);
  padding: 40px 50px 100px 50px;
  overflow-y: auto;
  scroll-behavior: smooth;
  position: relative;
}

/* Welcome Block */
.welcome-block {
  background: var(--bg-surface);
  border-radius: 24px;
  padding: 40px;
  margin-bottom: 50px;
  display: flex; flex-direction: column; gap: 30px;
  scroll-margin-top: var(--scroll-offset);
  /* 动画应用 */
  animation: fadeInUp 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards;
}

.welcome-header h1 {
  font-size: 32px;
  font-weight: 800; margin: 0 0 10px 0; color: var(--text-main); letter-spacing: -0.5px;
}

.welcome-info {
  font-size: 15px; color: var(--text-sub); font-weight: 500;
  display: flex; align-items: center; gap: 16px;
}
.welcome-info span { display: flex; align-items: center; gap: 8px; }

.stats-row { display: flex; flex-wrap: wrap; gap: 20px; }
.stat-item {
  background: var(--bg-app);
  border-radius: 16px;
  padding: 20px 30px; 
  min-width: 160px;
  display: flex; flex-direction: column; justify-content: center;
}

.stat-num { font-size: 24px; font-weight: 800; color: var(--text-main); margin-bottom: 6px; line-height: 1; }
.stat-label { font-size: 13px; color: var(--text-sub); font-weight: 600; letter-spacing: 0.5px; }
.stat-img-wrapper { height: 24px; display: flex; align-items: center; margin-bottom: 6px; }
.stat-img-wrapper img { height: 100%; width: auto; opacity: 0.7; filter: grayscale(100%); transition: 0.2s; }
.stat-item:hover .stat-img-wrapper img { filter: none; opacity: 1; }

/* Section Header & Tooltip */
.section { 
  margin-bottom: 60px; 
  scroll-margin-top: var(--scroll-offset); 
  /* 初始透明，JS控制依次显示 */
  opacity: 0; 
  animation: fadeInUp 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards;
}

.section-header {
  display: flex; align-items: center;
  margin-bottom: 24px; padding-left: 4px;
  cursor: pointer; user-select: none;
  width: fit-content;
}
.section-header h2 { 
  font-size: 22px; margin: 0; font-weight: 800; color: var(--text-main); 
  display: flex; align-items: center;
}
.section-header i { font-size: 20px; color: var(--text-sub); margin-right: 12px; }

/* 点击提示的小标签 */
.click-tip {
  font-size: 12px; 
  color: var(--text-sub); 
  font-weight: 400; 
  margin-left: 12px; 
  opacity: 0; 
  transform: translateX(-5px);
  transition: all 0.2s ease-out;
  background: var(--bg-block);
  padding: 4px 10px;
  border-radius: 6px;
  pointer-events: none;
}
.section-header:hover .click-tip { opacity: 1; transform: translateX(0); }
.section-header:active { opacity: 0.6; }

/* === Cards === */
.cards {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: 12px;
}

.card {
  background: var(--bg-surface);
  border-radius: var(--radius-card);
  padding: 14px;
  display: flex; flex-direction: row; align-items: center;
  text-decoration: none; position: relative; overflow: hidden;
  transition: transform 0.2s, background 0.2s;
  min-height: 72px;
}

.card:hover { 
  transform: translateY(-2px); 
  background: var(--bg-surface);
  z-index: 2;
  outline: 2px solid rgba(0,0,0,0.03);
}
.card:active { transform: scale(0.98); }

.card-icon {
  width: 40px; height: 40px;
  margin-right: 14px;
  border-radius: 10px;
  background: var(--bg-app); 
  display: flex; align-items: center; justify-content: center;
  flex-shrink: 0;
}

/* 图片淡入优化 */
.card-icon img { 
  width: 65%; height: 65%; object-fit: contain; 
  opacity: 0; transition: opacity 0.4s ease; 
}
.card-icon img.loaded { opacity: 1; }

.card-meta { flex: 1; display: flex; flex-direction: column; justify-content: center; overflow: hidden; }
.card-title {
  font-size: 15px; font-weight: 700; color: var(--text-main); margin-bottom: 2px;
  white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
}
.card-url {
  font-size: 12px; color: var(--text-sub);
  white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
}

/* Footer */
.footer {
  text-align: center; padding: 40px; font-size: 13px; color: var(--text-sub);
  background: var(--bg-app);
}

/* Refresh Button */
.refresh-btn {
  position: fixed; bottom: 30px; right: 30px;
  width: 48px; height: 48px; border-radius: 50%;
  background: var(--bg-surface);
  color: var(--text-main);
  border: none; 
  display: flex; align-items: center; justify-content: center;
  font-size: 18px; cursor: pointer;
  opacity: 0; visibility: hidden; transform: translateY(20px);
  transition: all 0.3s; z-index: 900;
  box-shadow: 0 4px 16px rgba(0,0,0,0.08);
}
body.dark-mode .refresh-btn { background: var(--bg-block); box-shadow: none; }

.refresh-btn.show { opacity: 1; visibility: visible; transform: translateY(0); }
.refresh-btn:hover { transform: translateY(-3px); background: var(--bg-block); }

/* Mobile */
@media (max-width: 768px) {
  .sidebar { display: none; }
  .header { padding: 0 20px; }
  .logo { height: 28px; }
  .container { width: 100%; }
  .main { padding: 24px 20px 80px 20px; margin-left: 0; width: 100%; }
  
  .cards { grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 10px; }
  .card { padding: 12px; border-radius: 12px; } 
  .card-icon { width: 32px; height: 32px; margin-right: 10px; border-radius: 8px; }
  .card-title { font-size: 13px; }
  .card-url { font-size: 11px; }

  .welcome-block { padding: 20px; border-radius: 16px; }
  .welcome-header h1 { font-size: 22px; }
  .stats-row { flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; }
  .stat-item { flex: 0 0 auto; min-width: 120px; padding: 14px; }
  
  .menu-toggle { display: block; font-size: 20px; color: var(--text-main); cursor: pointer; }
  .refresh-btn { bottom: 20px; right: 20px; width: 44px; height: 44px; }
}
@media (min-width: 769px) { .menu-toggle { display: none; } }
</style>
</head>
<body>

<div class="header">
  <div style="display:flex; align-items:center; gap:20px;">
    <div class="menu-toggle" id="menuToggle"><i class="fas fa-bars"></i></div>
    <div class="logo" onclick="location.reload()">
      <img id="site-logo" src="https://wangwenzhi.eu.org/images/ulefone-logo/logo.png" alt="Ulefone">
    </div>
  </div>
  
  <div class="header-controls">
    <input type="text" class="search-input" id="search" placeholder="搜索...">
    <button class="icon-btn" onclick="toggleTheme()" title="切换主题"><i class="fas fa-moon"></i></button>
    <a href="admin.html" class="icon-btn" title="管理后台"><i class="fas fa-cog"></i></a>
  </div>
</div>

<div class="container">
  <nav class="sidebar" id="sidebar">
    <ul id="category-list"></ul>
  </nav>
  
  <main class="main" id="mainContent">
    <div class="welcome-block" id="section-top">
      <div class="welcome-header">
        <h1 id="greeting-title">Ulefone Navigation</h1>
        <div class="welcome-info">
          <span id="date-info">Loading...</span>
        </div>
      </div>
      
      <div class="stats-row">
        <div class="stat-item">
          <div class="stat-num" id="stat-total">--</div>
          <div class="stat-label">书签</div>
        </div>
        <div class="stat-item">
          <div class="stat-num" id="stat-cats">--</div>
          <div class="stat-label">分类</div>
        </div>
        <div class="stat-item">
          <div class="stat-img-wrapper">
            <img src="https://hitscounter.dev/api/hit?url=https%3A%2F%2Fwww.ulefone.gq%2F&color=%23000000" alt="Visitor Counter">
          </div>
          <div class="stat-label">访问量</div>
        </div>
      </div>
    </div>

    <div id="content-area"></div>
    <div class="footer"><div>© 2023-2025 Ulefone Navigation</div></div>
  </main>
</div>

<button id="refreshBtn" class="refresh-btn" onclick="location.reload()" title="刷新页面">
  <i class="fas fa-redo-alt"></i>
</button>

<script src="data.js"></script>

<script>
function updateLogo(isDark) {
  const logo = document.getElementById('site-logo');
  const counter = document.querySelector('.stat-img-wrapper img');
  if(logo) logo.src = isDark 
    ? "https://wangwenzhi.eu.org/images/ulefone-logo/logo-white.png" 
    : "https://wangwenzhi.eu.org/images/ulefone-logo/logo.png";
  if(counter) {
      counter.src = isDark 
        ? "https://hitscounter.dev/api/hit?url=https%3A%2F%2Fwww.ulefone.gq%2F&color=%23ffffff"
        : "https://hitscounter.dev/api/hit?url=https%3A%2F%2Fwww.ulefone.gq%2F&color=%23000000";
  }
}

function loadTheme() {
  const isDark = localStorage.getItem('darkMode') === 'enabled' || 
                 (window.matchMedia('(prefers-color-scheme: dark)').matches && !localStorage.getItem('darkMode'));
  document.body.classList.toggle('dark-mode', isDark);
  updateLogo(isDark);
  document.querySelector('.fa-moon').className = isDark ? 'fas fa-sun' : 'fas fa-moon';
}

function toggleTheme() {
  const isDark = document.body.classList.toggle('dark-mode');
  localStorage.setItem('darkMode', isDark ? 'enabled' : 'disabled');
  updateLogo(isDark);
  document.querySelector('.theme-btn i, .fa-moon, .fa-sun').className = isDark ? 'fas fa-sun' : 'fas fa-moon';
}

function updateGreeting() {
    const hour = new Date().getHours();
    const title = document.getElementById('greeting-title');
    let greet = "Ulefone Navigation";
    if (hour >= 5 && hour < 12) greet = "Good Morning";
    else if (hour >= 12 && hour < 18) greet = "Good Afternoon";
    else if (hour >= 18 && hour < 22) greet = "Good Evening";
    else greet = "Good Night";
    title.textContent = greet;
}

function updateDate() {
    const now = new Date();
    const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
    document.getElementById('date-info').textContent = now.toLocaleDateString('zh-CN', options);
}

function getDomain(url) {
  try { return new URL(url).hostname.replace('www.', ''); } catch { return 'link'; }
}

// 核心优化：高亮匹配文字
function highlightText(text, query) {
  if (!query) return text;
  const regex = new RegExp(`(${query})`, 'gi');
  return text.replace(regex, '<mark>$1</mark>');
}

function createCard(item, query = '') {
  const domain = getDomain(item.url);
  const faviconUrl = `https://www.google.com/s2/favicons?sz=64&domain_url=${item.url}`;
  
  // 应用高亮
  const displayName = highlightText(item.name, query);
  const displayDomain = highlightText(domain, query);

  return `
  <a class="card" href="${item.url}" target="_blank">
    <div class="card-icon">
      <img src="${faviconUrl}" onload="this.classList.add('loaded')" 
           onerror="this.src='https://ui-avatars.com/api/?name=${item.name}&background=random&color=fff&size=64'; this.classList.add('loaded');">
    </div>
    <div class="card-meta">
      <div class="card-title" title="${item.name}">${displayName}</div>
      <div class="card-url">${displayDomain}</div>
    </div>
  </a>`;
}

function renderContent(dataObj) {
  const container = document.getElementById("content-area");
  const sidebarList = document.getElementById("category-list");
  
  container.innerHTML = '';
  sidebarList.innerHTML = '';

  const homeLi = document.createElement('li');
  homeLi.className = 'active'; 
  homeLi.innerHTML = `<i class="fas fa-home"></i> 顶部`;
  homeLi.dataset.target = 'section-top';
  homeLi.onclick = () => scrollToSection('section-top');
  sidebarList.appendChild(homeLi);

  Object.keys(dataObj).forEach((key, index) => {
    const li = document.createElement('li');
    li.innerHTML = `<i class="fas fa-folder"></i> ${key}`;
    li.dataset.target = `section-${index}`;
    li.onclick = () => scrollToSection(`section-${index}`);
    sidebarList.appendChild(li);

    const section = document.createElement("div");
    section.className = "section";
    section.id = `section-${index}`; 
    // 增加交错动画延迟
    section.style.animationDelay = `${index * 0.05}s`;
    
    section.innerHTML = `
      <div class="section-header">
        <i class="fas fa-folder-open"></i>
        <h2>${key} <span class="click-tip">点击打开全部</span></h2>
      </div>
      <div class="cards">
        ${dataObj[key].map(item => createCard(item)).join('')}
      </div>
    `;
    
    const header = section.querySelector('.section-header');
    header.onclick = () => { dataObj[key].forEach(item => window.open(item.url, '_blank')); };
    
    container.appendChild(section);
  });

  updateStats(dataObj);
  setupScrollSpy();
}

function scrollToSection(id) {
  const el = document.getElementById(id);
  if(el) {
    if(window.innerWidth <= 768) {
      document.getElementById('sidebar').style.display = 'none';
    }
    el.scrollIntoView({ behavior: 'smooth', block: 'start' });
  }
}

function setupScrollSpy() {
  const main = document.getElementById('mainContent');
  const sections = document.querySelectorAll('.section, .welcome-block');
  const navItems = document.querySelectorAll('#category-list li');

  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        navItems.forEach(item => item.classList.remove('active'));
        const id = entry.target.id;
        const activeItem = document.querySelector(`#category-list li[data-target="${id}"]`);
        if(activeItem) {
          activeItem.classList.add('active');
          activeItem.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
      }
    });
  }, {
    root: main, 
    threshold: 0.1, 
    rootMargin: "-20% 0px -60% 0px"
  });

  sections.forEach(section => observer.observe(section));
}

function updateStats(dataObj) {
  const total = Object.values(dataObj).flat().length;
  const categories = Object.keys(dataObj).length;
  document.getElementById('stat-total').textContent = total;
  document.getElementById('stat-cats').textContent = categories;
}

// 核心优化：搜索逻辑 + 高亮
function filterBookmarks(e) {
  const query = e.target.value.toLowerCase().trim();
  const sections = document.querySelectorAll('.section');
  
  if(!query) {
    // 恢复所有显示，并移除高亮
    renderContent(data); 
    return;
  }

  // 在现有 DOM 上操作或重新渲染（这里为了高亮简单起见，局部重新生成 HTML 可能更好，
  // 但为了性能，我们操作显隐，并动态替换 innerHTML 来高亮）
  
  // 简易方案：遍历数据重新渲染匹配项
  const container = document.getElementById("content-area");
  container.innerHTML = ''; // 清空当前

  let hasAnyMatch = false;

  Object.keys(data).forEach((key) => {
    const items = data[key];
    // 过滤匹配项
    const matches = items.filter(item => 
      item.name.toLowerCase().includes(query) || 
      item.url.toLowerCase().includes(query)
    );

    if(matches.length > 0) {
      hasAnyMatch = true;
      const section = document.createElement("div");
      section.className = "section";
      // 搜索模式下移除动画延迟，立即显示
      section.style.animation = 'none';
      section.style.opacity = 1;
      
      section.innerHTML = `
        <div class="section-header">
          <i class="fas fa-folder-open"></i>
          <h2>${key}</h2>
        </div>
        <div class="cards">
          ${matches.map(item => createCard(item, query)).join('')}
        </div>
      `;
      container.appendChild(section);
    }
  });

  if(!hasAnyMatch) {
    container.innerHTML = `
      <div style="text-align:center; padding: 40px; color: var(--text-sub);">
        <i class="fas fa-ghost" style="font-size: 48px; margin-bottom: 20px; opacity: 0.2;"></i>
        <p>没有找到相关书签</p>
      </div>`;
  }
}

document.addEventListener('DOMContentLoaded', () => {
  loadTheme();
  
  if(typeof data !== 'undefined') {
    renderContent(data);
  }

  document.getElementById('search').addEventListener('input', filterBookmarks);
  
  const menuToggle = document.getElementById('menuToggle');
  const sidebar = document.getElementById('sidebar');
  if(menuToggle) {
    menuToggle.addEventListener('click', () => {
      const isVisible = sidebar.style.display === 'flex';
      sidebar.style.display = isVisible ? 'none' : 'flex';
      if(!isVisible) {
        sidebar.style.position = 'fixed';
        sidebar.style.top = '72px'; sidebar.style.bottom = '0';
        sidebar.style.zIndex = '99'; sidebar.style.width = '100%';
        sidebar.style.borderRight = 'none';
      }
    });
  }
  
  const refreshBtn = document.getElementById('refreshBtn');
  document.getElementById('mainContent').addEventListener('scroll', function() {
    if(this.scrollTop > 300) refreshBtn.classList.add('show');
    else refreshBtn.classList.remove('show');
  });

  updateGreeting();
  updateDate();
});
</script>
</body>
</html>