<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Ulefone | Navigation</title>
<link rel="icon" href="https://wangwenzhi.eu.org/images/ulefone-logo/icon.png" sizes="32x32" type="image/png"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>

<style>
:root {
  /* 色块系统 */
  --bg-app: #f5f5f7;
  --bg-surface: #ffffff;
  --bg-block: #efeff1;
  --bg-active: #e5e5e7;
  
  --text-main: #000000;
  --text-sub: #86868b;
  
  --sidebar-width: 240px;
  --header-height: 72px;
  
  --radius-card: 16px;
  --pill: 99px;
  
  /* 核心修复：锚点定位偏移量 (Header高度 + 间距) */
  --scroll-offset: 90px;
}

/* 暗黑模式 */
body.dark-mode {
  --bg-app: #000000;
  --bg-surface: #1c1c1e;
  --bg-block: #2c2c2e;
  --bg-active: #3a3a3c;
  --text-main: #ffffff;
  --text-sub: #98989d;
}

body {
  margin: 0;
  background: var(--bg-app);
  color: var(--text-main);
  font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", Roboto, sans-serif;
  font-size: 16px;
  line-height: 1.5;
  /* 核心修复：恢复原生滚动 */
  overflow-x: hidden;
  overflow-y: auto; 
}

a { text-decoration: none; color: inherit; }
* { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }

/* === Header (Fixed Top) === */
.header {
  height: var(--header-height);
  background: var(--bg-surface);
  /* 增加底部极淡边框，防止纯白背景下与内容混淆 */
  border-bottom: 1px solid rgba(0,0,0,0.03);
  display: flex; align-items: center; justify-content: space-between;
  padding: 0 40px;
  
  /* 固定在顶部 */
  position: fixed; top: 0; left: 0; right: 0; z-index: 1000;
}
body.dark-mode .header { border-bottom: 1px solid rgba(255,255,255,0.05); }

.header-left, .header-right { flex: 0 0 auto; display: flex; align-items: center; gap: 16px; }
.header-center { flex: 1; display: flex; justify-content: center; }

.logo { height: 36px; display: flex; align-items: center; cursor: pointer; opacity: 0.95; }
.logo:hover { opacity: 1; }
.logo img { height: 100%; width: auto; display: block; }

.search-input {
  border: none;
  background: var(--bg-app);
  padding: 12px 24px;
  border-radius: var(--pill);
  font-size: 15px;
  color: var(--text-main);
  width: 100%; max-width: 400px;
  transition: all 0.2s;
}
.search-input:focus { background: var(--bg-block); max-width: 440px; }

.icon-btn {
  background: transparent; border: none; padding: 0;
  color: var(--text-main); font-size: 20px;
  width: 44px; height: 44px; border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  cursor: pointer; transition: background 0.2s;
}
.icon-btn:hover { background: var(--bg-block); }

/* === Sidebar (Fixed Left) === */
.sidebar {
  width: var(--sidebar-width);
  background: var(--bg-surface);
  padding: 30px 16px;
  
  /* 核心修复：侧边栏独立固定 */
  position: fixed; 
  top: var(--header-height); 
  bottom: 0; 
  left: 0;
  overflow-y: auto;
  z-index: 90;
  /* 可选：右侧分割线 */
  border-right: 1px solid rgba(0,0,0,0.02);
}
.sidebar::-webkit-scrollbar { display: none; }
body.dark-mode .sidebar { border-right: 1px solid rgba(255,255,255,0.03); }

#category-list { list-style: none; padding: 0; margin: 0; display: flex; flex-direction: column; gap: 2px; }

/* 侧边栏项：紧凑胶囊 */
#category-list li {
  padding: 10px 16px;
  border-radius: var(--pill);
  font-size: 15px; font-weight: 600;
  color: var(--text-sub);
  cursor: pointer;
  display: flex; align-items: center;
  transition: all 0.15s;
}
#category-list li i { width: 24px; font-size: 16px; margin-right: 10px; text-align: center; color: var(--text-sub); }

#category-list li:hover { background: var(--bg-block); color: var(--text-main); }
#category-list li:hover i { color: var(--text-main); }

#category-list li.active {
  background: var(--bg-active);
  color: var(--text-main);
  font-weight: 700;
}
#category-list li.active i { color: var(--text-main); }

/* === Main Content (Flow Layout) === */
.main {
  /* 核心修复：主内容左侧留出侧边栏宽度，顶部留出Header高度 */
  margin-left: var(--sidebar-width);
  margin-top: var(--header-height);
  
  padding: 40px 50px 100px 50px;
  background: var(--bg-app);
  min-height: calc(100vh - var(--header-height));
}

/* Welcome Block */
.welcome-block {
  background: var(--bg-surface);
  border-radius: 24px;
  padding: 40px;
  margin-bottom: 50px;
  display: flex; flex-direction: column; gap: 30px;
  
  /* 防止被 Header 遮挡 */
  scroll-margin-top: var(--scroll-offset);
}

.welcome-header h1 {
  font-size: 32px; font-weight: 800; margin: 0 0 10px 0; color: var(--text-main); letter-spacing: -0.5px;
}
.welcome-info {
  font-size: 15px; color: var(--text-sub); font-weight: 500; display: flex; align-items: center; gap: 16px;
}

.stats-row { display: flex; flex-wrap: wrap; gap: 20px; }
.stat-item {
  background: var(--bg-app);
  border-radius: 16px; padding: 20px 30px; min-width: 160px;
  display: flex; flex-direction: column; justify-content: center;
}
.stat-num { font-size: 24px; font-weight: 800; color: var(--text-main); margin-bottom: 6px; line-height: 1; }
.stat-label { font-size: 13px; color: var(--text-sub); font-weight: 600; letter-spacing: 0.5px; }
.stat-img-wrapper { height: 24px; display: flex; align-items: center; margin-bottom: 6px; }
.stat-img-wrapper img { height: 100%; width: auto; opacity: 0.7; filter: grayscale(100%); transition: 0.2s; }
.stat-item:hover .stat-img-wrapper img { filter: none; opacity: 1; }

/* Section */
.section { 
  margin-bottom: 60px; 
  /* 核心修复：确保点击跳转时标题露出 */
  scroll-margin-top: var(--scroll-offset);
}

.section-header {
  display: flex; align-items: center;
  margin-bottom: 24px; padding-left: 4px;
  cursor: pointer; user-select: none;
  width: fit-content;
}
.section-header h2 { font-size: 22px; margin: 0; font-weight: 800; color: var(--text-main); display: flex; align-items: center; }
.section-header i { font-size: 20px; color: var(--text-sub); margin-right: 12px; }

.click-tip {
  font-size: 12px; color: var(--text-sub); font-weight: 400; margin-left: 12px; 
  opacity: 0; transform: translateX(-5px); transition: all 0.2s ease-out;
  background: var(--bg-block); padding: 4px 10px; border-radius: 6px; pointer-events: none;
}
.section-header:hover .click-tip { opacity: 1; transform: translateX(0); }

/* === Cards (Rectangular) === */
.cards {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: 12px;
}

.card {
  background: var(--bg-surface);
  border-radius: var(--radius-card);
  padding: 14px;
  display: flex; flex-direction: row; align-items: center;
  text-decoration: none; position: relative; overflow: hidden;
  transition: transform 0.2s, background 0.2s;
  min-height: 72px;
}
.card:hover { transform: translateY(-2px); background: var(--bg-surface); z-index: 2; outline: 2px solid rgba(0,0,0,0.03); }
.card:active { transform: scale(0.98); }

.card-icon {
  width: 40px; height: 40px; margin-right: 14px; border-radius: 10px;
  background: var(--bg-app); display: flex; align-items: center; justify-content: center; flex-shrink: 0;
}
.card-icon img { width: 65%; height: 65%; object-fit: contain; opacity: 0; transition: opacity 0.3s; }
.card-icon img.loaded { opacity: 1; }

.card-meta { flex: 1; display: flex; flex-direction: column; justify-content: center; overflow: hidden; }
.card-title { font-size: 15px; font-weight: 700; color: var(--text-main); margin-bottom: 2px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.card-url { font-size: 12px; color: var(--text-sub); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

/* Footer */
.footer { text-align: center; padding: 40px; font-size: 13px; color: var(--text-sub); }

/* Back To Top Button (回归：回到顶部) */
.back-to-top {
  position: fixed; bottom: 30px; right: 30px;
  width: 48px; height: 48px; border-radius: 50%;
  background: var(--bg-surface); color: var(--text-main);
  border: none; 
  display: flex; align-items: center; justify-content: center;
  font-size: 18px; cursor: pointer;
  opacity: 0; visibility: hidden; transform: translateY(20px);
  transition: all 0.3s; z-index: 900;
  box-shadow: 0 4px 16px rgba(0,0,0,0.08);
}
body.dark-mode .back-to-top { background: var(--bg-block); box-shadow: none; }
.back-to-top.show { opacity: 1; visibility: visible; transform: translateY(0); }
.back-to-top:hover { transform: translateY(-3px); background: var(--bg-block); }

/* Mobile */
@media (max-width: 768px) {
  .header { padding: 0 20px; }
  .header-center { display: none; } /* 移动端暂隐搜索框，或移入菜单 */
  
  .sidebar { 
    display: none; top: 72px; width: 100%; border-right: none; background: var(--bg-surface);
  }
  
  .main { margin-left: 0; padding: 24px 20px 80px 20px; }
  
  .cards { grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 10px; }
  .card { padding: 12px; border-radius: 12px; }
  
  .menu-toggle { display: block; font-size: 20px; color: var(--text-main); cursor: pointer; }
  .back-to-top { bottom: 20px; right: 20px; width: 44px; height: 44px; }
}
@media (min-width: 769px) { .menu-toggle { display: none; } }
</style>
</head>
<body>

<div class="header">
  <div class="header-left">
    <div class="menu-toggle" id="menuToggle"><i class="fas fa-bars"></i></div>
    <div class="logo" onclick="location.reload()">
      <img id="site-logo" src="https://wangwenzhi.eu.org/images/ulefone-logo/logo.png" alt="Ulefone">
    </div>
  </div>
  
  <div class="header-center">
    <input type="text" class="search-input" id="search" placeholder="搜索...">
  </div>
  
  <div class="header-right">
    <button class="icon-btn" onclick="toggleTheme()" title="切换主题"><i class="fas fa-moon"></i></button>
    <a href="admin.html" class="icon-btn" title="管理后台"><i class="fas fa-cog"></i></a>
  </div>
</div>

<nav class="sidebar" id="sidebar">
  <ul id="category-list"></ul>
</nav>

<main class="main" id="mainContent">
  <div class="welcome-block" id="section-top">
    <div class="welcome-header">
      <h1 id="greeting-title">Ulefone Navigation</h1>
      <div class="welcome-info">
        <span id="date-info">Loading...</span>
      </div>
    </div>
    
    <div class="stats-row">
      <div class="stat-item">
        <div class="stat-num" id="stat-total">--</div>
        <div class="stat-label">书签</div>
      </div>
      <div class="stat-item">
        <div class="stat-num" id="stat-cats">--</div>
        <div class="stat-label">分类</div>
      </div>
      <div class="stat-item">
        <div class="stat-img-wrapper">
          <img src="https://hitscounter.dev/api/hit?url=https%3A%2F%2Fwww.ulefone.gq%2F&color=%23000000" alt="Visitor Counter">
        </div>
        <div class="stat-label">访问量</div>
      </div>
    </div>
  </div>

  <div id="content-area"></div>
  <div class="footer"><div>© 2023-2025 Ulefone Navigation</div></div>
</main>

<button id="backToTop" class="back-to-top" onclick="window.scrollTo({top:0, behavior:'smooth'})" title="回到顶部">
  <i class="fas fa-arrow-up"></i>
</button>

<script src="data.js"></script>

<script>
// === Theme Logic ===
function updateLogo(isDark) {
  const logo = document.getElementById('site-logo');
  const counter = document.querySelector('.stat-img-wrapper img');
  if(logo) logo.src = isDark 
    ? "https://wangwenzhi.eu.org/images/ulefone-logo/logo-white.png" 
    : "https://wangwenzhi.eu.org/images/ulefone-logo/logo.png";
  if(counter) {
      counter.src = isDark 
        ? "https://hitscounter.dev/api/hit?url=https%3A%2F%2Fwww.ulefone.gq%2F&color=%23ffffff"
        : "https://hitscounter.dev/api/hit?url=https%3A%2F%2Fwww.ulefone.gq%2F&color=%23000000";
  }
}

function loadTheme() {
  const isDark = localStorage.getItem('darkMode') === 'enabled' || 
                 (window.matchMedia('(prefers-color-scheme: dark)').matches && !localStorage.getItem('darkMode'));
  document.body.classList.toggle('dark-mode', isDark);
  updateLogo(isDark);
  document.querySelector('.fa-moon').className = isDark ? 'fas fa-sun' : 'fas fa-moon';
}

function toggleTheme() {
  const isDark = document.body.classList.toggle('dark-mode');
  localStorage.setItem('darkMode', isDark ? 'enabled' : 'disabled');
  updateLogo(isDark);
  document.querySelector('.theme-btn i, .fa-moon, .fa-sun').className = isDark ? 'fas fa-sun' : 'fas fa-moon';
}

// === Greeting ===
function updateGreeting() {
    const hour = new Date().getHours();
    const title = document.getElementById('greeting-title');
    let greet = "Ulefone Navigation";
    if (hour >= 5 && hour < 12) greet = "Good Morning";
    else if (hour >= 12 && hour < 18) greet = "Good Afternoon";
    else if (hour >= 18 && hour < 22) greet = "Good Evening";
    else greet = "Good Night";
    title.textContent = greet;
}

function updateDate() {
    const now = new Date();
    const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
    document.getElementById('date-info').textContent = now.toLocaleDateString('zh-CN', options);
}

// === Data & Render ===
function getDomain(url) {
  try { return new URL(url).hostname.replace('www.', ''); } catch { return 'link'; }
}

function createCard(item) {
  const domain = getDomain(item.url);
  const faviconUrl = `https://www.google.com/s2/favicons?sz=64&domain_url=${item.url}`;
  return `
  <a class="card" href="${item.url}" target="_blank">
    <div class="card-icon">
      <img src="${faviconUrl}" onload="this.classList.add('loaded')" 
           onerror="this.src='https://ui-avatars.com/api/?name=${item.name}&background=random&color=fff&size=64'; this.classList.add('loaded');">
    </div>
    <div class="card-meta">
      <div class="card-title" title="${item.name}">${item.name}</div>
      <div class="card-url">${domain}</div>
    </div>
  </a>`;
}

function renderContent(dataObj) {
  const container = document.getElementById("content-area");
  const sidebarList = document.getElementById("category-list");
  
  container.innerHTML = '';
  sidebarList.innerHTML = '';

  const homeLi = document.createElement('li');
  homeLi.className = 'active'; 
  homeLi.innerHTML = `<i class="fas fa-home"></i> 顶部`;
  homeLi.dataset.target = 'section-top';
  homeLi.onclick = () => window.scrollTo({top:0, behavior:'smooth'});
  sidebarList.appendChild(homeLi);

  Object.keys(dataObj).forEach((key, index) => {
    // 侧边栏项
    const li = document.createElement('li');
    li.innerHTML = `<i class="fas fa-folder"></i> ${key}`;
    li.dataset.target = `section-${index}`;
    // 使用 getElementById 滚动到具体元素
    li.onclick = () => {
        const el = document.getElementById(`section-${index}`);
        if(el) el.scrollIntoView({behavior: 'smooth', block: 'start'});
        if(window.innerWidth <= 768) document.getElementById('sidebar').style.display = 'none';
    };
    sidebarList.appendChild(li);

    // 内容区块
    const section = document.createElement("div");
    section.className = "section";
    section.id = `section-${index}`; 
    
    // 单击打开全部
    section.innerHTML = `
      <div class="section-header">
        <i class="fas fa-folder-open"></i>
        <h2>${key} <span class="click-tip">点击打开全部</span></h2>
      </div>
      <div class="cards">
        ${dataObj[key].map(createCard).join('')}
      </div>
    `;
    const header = section.querySelector('.section-header');
    header.onclick = () => { dataObj[key].forEach(item => window.open(item.url, '_blank')); };
    
    container.appendChild(section);
  });

  updateStats(dataObj);
  setupScrollSpy();
}

// === Scroll Spy (Body Scroll) ===
function setupScrollSpy() {
  const sections = document.querySelectorAll('.section, .welcome-block');
  const navItems = document.querySelectorAll('#category-list li');

  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        navItems.forEach(item => item.classList.remove('active'));
        const id = entry.target.id;
        const activeItem = document.querySelector(`#category-list li[data-target="${id}"]`);
        if(activeItem) {
          activeItem.classList.add('active');
        }
      }
    });
  }, {
    root: null, // Use viewport
    threshold: 0.1, 
    rootMargin: "-20% 0px -60% 0px"
  });

  sections.forEach(section => observer.observe(section));
}

function updateStats(dataObj) {
  const total = Object.values(dataObj).flat().length;
  const categories = Object.keys(dataObj).length;
  document.getElementById('stat-total').textContent = total;
  document.getElementById('stat-cats').textContent = categories;
}

function filterBookmarks(e) {
  const query = e.target.value.toLowerCase().trim();
  const cards = document.querySelectorAll('.card');
  const sections = document.querySelectorAll('.section');
  
  if(!query) {
    sections.forEach(sec => sec.style.display = 'block');
    cards.forEach(card => card.style.display = 'flex');
    return;
  }

  sections.forEach(sec => {
    let hasVisible = false;
    const sectionCards = sec.querySelectorAll('.card');
    sectionCards.forEach(card => {
      const text = card.innerText.toLowerCase();
      if(text.includes(query)) {
        card.style.display = 'flex';
        hasVisible = true;
      } else {
        card.style.display = 'none';
      }
    });
    sec.style.display = hasVisible ? 'block' : 'none';
  });
}

document.addEventListener('DOMContentLoaded', () => {
  loadTheme();
  if(typeof data !== 'undefined') renderContent(data);
  document.getElementById('search').addEventListener('input', filterBookmarks);
  
  // Mobile Menu
  const menuToggle = document.getElementById('menuToggle');
  const sidebar = document.getElementById('sidebar');
  if(menuToggle) {
    menuToggle.addEventListener('click', () => {
      const isVisible = sidebar.style.display === 'flex';
      sidebar.style.display = isVisible ? 'none' : 'flex';
    });
  }
  
  // Scroll Listener on Window (Body Scroll)
  const backBtn = document.getElementById('backToTop');
  window.addEventListener('scroll', () => {
    if(window.scrollY > 300) backBtn.classList.add('show');
    else backBtn.classList.remove('show');
  });

  updateGreeting();
  updateDate();
});
</script>
</body>
</html>